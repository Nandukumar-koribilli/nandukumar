<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday, My Dearest Didiluuu ‚ú®üíñüçÇ</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        :root {
            --star-color: rgba(255, 255, 255, 0.8);
            --star-background: #081020;
            --leaf-color-1: #f3a683;
            --leaf-color-2: #d4ac8a;
            --leaf-color-3: #eab4b4;
            --card-glow: rgba(255, 255, 230, 0.35);
            --text-color: #453c38;
            --highlight-pink: #f08080;
            --firework-color: hsl(50, 100%, 70%);
            --confetti-color: hsl(120, 100%, 70%);
            --heart-color: #ff4d6d;
            --balloon-hue: 0;
        }

        body {
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: var(--star-background);
            background-image:
                radial-gradient(circle at 1px 1px, var(--star-color) 1px, transparent 0),
                radial-gradient(circle at 15px 10px, var(--star-color) 1px, transparent 0);
            background-size: 50px 50px;
            background-position: 0 0, 25px 25px;
            animation: starryNight 150s linear infinite;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            position: relative;
        }

        @keyframes starryNight {
            from { background-position: 0 0, 25px 25px; }
            to { background-position: -1500px 750px, -1475px 775px; }
        }

        body::before {
            content: '';
            position: fixed;
            bottom: -50px;
            left: 10%;
            width: 200px;
            height: 40%;
            background: linear-gradient(to top, transparent, rgba(0, 0, 0, 0.2)),
                        radial-gradient(ellipse at bottom, #1a1a1a 30%, transparent 70%);
            border-radius: 50% 50% 0 0 / 100% 100% 0 0;
            transform: rotate(5deg);
            opacity: 0.3;
            z-index: 0;
            filter: blur(3px);
        }

        body::after {
            content: '';
            position: fixed;
            bottom: 15%;
            left: 5%;
            width: 280px;
            height: 250px;
            background: radial-gradient(ellipse at center, rgba(10, 30, 40, 0.25) 10%, transparent 70%);
            border-radius: 50%;
            transform: translateX(20px) rotate(3deg);
            opacity: 0.25;
            z-index: 0;
            filter: blur(8px);
        }

        #leafContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3;
            overflow: hidden;
        }

        .leaf {
            position: absolute;
            top: -20px;
            width: 15px;
            height: 10px;
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            background-color: var(--leaf-color-1);
            opacity: 0;
            animation: fall 8s linear infinite;
            transform-origin: 50% 50%;
        }

        .leaf.shape2 {
            border-radius: 70% 30% 30% 70% / 70% 70% 30% 30%;
            width: 12px;
            height: 12px;
        }

        .leaf.shape3 {
            border-radius: 50%;
            width: 10px;
            height: 10px;
        }

        @keyframes fall {
            0% { transform: translateY(0) rotateZ(0deg) rotateX(0deg); opacity: 0; }
            10% { opacity: 0.9; }
            90% { opacity: 0.9; }
            100% { transform: translateY(105vh) rotateZ(360deg) rotateX(180deg); opacity: 0; }
        }

        #shootingStarsContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .shooting-star {
            position: absolute;
            height: 1.5px;
            background: linear-gradient(-135deg, rgba(255, 255, 240, 1), rgba(255, 255, 240, 0));
            border-radius: 999px;
            filter: drop-shadow(0 0 5px rgba(255, 255, 240, 0.8));
            animation: shooting linear infinite;
            opacity: 0;
            transform-origin: top left;
        }

        @keyframes shooting {
            0% { transform: translateX(0) translateY(0) rotate(45deg); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateX(80vw) translateY(110vh) rotate(45deg); opacity: 0; }
        }

        .initial-prompt {
            color: #f0e8e8;
            font-size: clamp(20px, 4.5vw, 26px);
            font-family: 'Pacifico', cursive;
            text-align: center;
            text-shadow: 0 0 10px rgba(255, 182, 193, 0.6);
            animation: subtlePulse 3s infinite ease-in-out;
            z-index: 10;
            position: absolute;
            top: calc(50% - clamp(500px, 80vh, 600px)/2 - 60px);
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 400px;
            padding: 10px;
            transition: opacity 0.5s ease-out;
        }

        .initial-prompt.hidden {
            opacity: 0;
            pointer-events: none;
        }

        @keyframes subtlePulse {
            0%, 100% { opacity: 0.7; transform: translateX(-50%) scale(1); }
            50% { opacity: 1; transform: translateX(-50%) scale(1.04); }
        }

        .card-container {
            width: clamp(300px, 90vw, 380px);
            height: clamp(500px, 80vh, 600px);
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            filter: drop-shadow(0 0 20px var(--card-glow));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 0;
            position: relative;
            z-index: 5;
            perspective: 1800px;
            cursor: pointer;
        }

        .card {
            width: 100%;
            height: 100%;
            position: relative;
            background-color: transparent;
            border-radius: 20px;
            transform-style: preserve-3d;
        }

        .card-page {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            padding: 35px 30px;
            box-sizing: border-box;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transform-origin: left center;
            transition: transform 1s cubic-bezier(0.6, -0.28, 0.74, 1.05), opacity 0.5s ease;
            backface-visibility: hidden;
            background-color: #fffef8;
            border-radius: 20px;
            transform: rotateY(180deg);
            opacity: 0;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12) inset;
            color: var(--text-color);
        }

        .card-page.visible {
            transform: rotateY(0deg);
            opacity: 1;
            z-index: 10;
        }

        .card-page.next-page {
            transform: rotateY(0deg);
            opacity: 1;
            z-index: 9;
        }

        .card-page.flipped {
            transform: rotateY(-180deg);
            opacity: 0;
            z-index: 8;
        }

        .card-cover {
            transform: rotateY(0deg);
            opacity: 1;
            z-index: 15;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            background: linear-gradient(140deg, #fffef8, #fff8e8);
        }

        .banner {
            background: linear-gradient(45deg, #ff9a9e, #fad0c4);
            width: 100%;
            padding: 15px 0;
            text-align: center;
            font-size: clamp(20px, 5vw, 26px);
            font-weight: bold;
            color: white;
            position: absolute;
            top: 0;
            left: 0;
            font-family: 'Pacifico', cursive;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.15);
            border-radius: 20px 20px 0 0;
        }

        .cake-image {
            width: 70%;
            max-width: 220px;
            height: auto;
            margin-top: 110px;
            transition: transform 0.6s ease;
        }

        .cake-image:hover {
            transform: scale(1.05) rotate(-2deg);
        }

        .cover-prompt {
            font-family: 'Dancing Script', cursive;
            margin-top: 25px;
            color: #a08c84;
            font-size: 18px;
            font-style: italic;
        }

        .message-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px 10px;
            margin-top: 10px;
            scrollbar-width: thin;
            scrollbar-color: #e8dcd1 #fffef8;
        }

        .message-container::-webkit-scrollbar {
            width: 8px;
        }

        .message-container::-webkit-scrollbar-track {
            background: #fffef8;
            border-radius: 10px;
        }

        .message-container::-webkit-scrollbar-thumb {
            background-color: #e8dcd1;
            border-radius: 10px;
            border: 2px solid #fffef8;
        }

        .message {
            text-align: left;
            font-family: 'Dancing Script', cursive;
            font-size: clamp(19px, 4vw, 25px);
            color: var(--text-color);
            line-height: 1.75;
            text-shadow: 0 0 1px rgba(0,0,0,0.05);
        }

        .heart-icon {
            color: var(--highlight-pink);
            font-size: inherit;
            vertical-align: baseline;
            margin: 0 3px;
        }

        .page-image {
            width: clamp(130px, 45%, 180px);
            height: auto;
            display: block;
            margin: 25px auto;
            border-radius: 12px;
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.18);
            opacity: 0;
            transform: scale(0.9);
            animation: fadeInScale 1s 0.4s ease-out forwards;
        }

        @keyframes fadeInScale {
            to { opacity: 1; transform: scale(1); }
        }

        hr.heart-divider {
            border: 0;
            height: 25px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="%23f08080"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
            margin: 30px 0;
            opacity: 0.7;
        }

        #page11 .message-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #page11 .message {
            text-align: center;
        }

        #page11 .final-signature {
            font-size: 28px;
            font-weight: 700;
            color: #6a5a53;
            margin-top: 15px;
        }

        #page11 .final-name {
            font-size: 24px;
            color: #8a7a73;
        }

        #page11 .final-hearts {
            margin-top: 20px;
            font-size: 22px;
        }

        .balloon {
            position: absolute;
            width: 45px;
            height: 55px;
            background-color: hsla(var(--balloon-hue, 0), 100%, 70%, 0.8);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            animation: float 6s ease-in-out infinite;
            z-index: 6;
            opacity: 0;
            bottom: -150px;
        }

        .balloon::after {
            content: "";
            position: absolute;
            width: 1px;
            height: 80px;
            background-color: rgba(0, 0, 0, 0.5);
            bottom: -80px;
            left: 50%;
            transform: translateX(-50%);
        }

        .balloon:nth-child(2n) {
            animation-duration: 7.5s;
        }

        .balloon:nth-child(3n) {
            animation-duration: 5s;
        }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg) scale(0.8); opacity: 0; }
            10% { opacity: 0.9; }
            50% { transform: translateY(-60vh) rotate(15deg); }
            90% { opacity: 0.9; }
            100% { transform: translateY(-100vh) rotate(-15deg) scale(1.1); opacity: 0; }
        }

        .confetti {
            position: absolute;
            width: 8px;
            height: 12px;
            opacity: 0;
            z-index: 12;
            animation: confettiFall 3.5s ease-out forwards;
            transform-origin: center;
        }

        .confetti.triangle {
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 10px solid var(--confetti-color);
            background: none !important;
        }

        .confetti.circle {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        @keyframes confettiFall {
            0% { transform: translateY(-50px) rotateZ(0deg) rotateY(0deg); opacity: 1; }
            100% { transform: translateY(105vh) rotateZ(720deg) rotateY(360deg); opacity: 0; }
        }

        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            box-shadow: 0 0 12px 6px var(--firework-color);
            color: var(--firework-color);
            animation: explode 0.8s ease-out forwards;
            opacity: 0;
            z-index: 7;
        }

        @keyframes explode {
            0% { transform: scale(0.1); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }

        .heart {
            position: absolute;
            width: 20px;
            height: 20px;
            opacity: 0;
            z-index: 6;
            animation: floatHearts 5s ease-out forwards;
            transform: rotate(-45deg);
            background-color: var(--heart-color);
        }

        .heart::before,
        .heart::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: var(--heart-color);
        }

        .heart::before {
            top: -10px;
            left: 0;
        }

        .heart::after {
            left: 10px;
            top: 0;
        }

        @keyframes floatHearts {
            0% { transform: translateY(100vh) rotate(-45deg) scale(0.5); opacity: 0; }
            15% { opacity: 0.9; }
            85% { opacity: 0.9; }
            100% { transform: translateY(-100px) rotate(-30deg) scale(1); opacity: 0; }
        }
    </style>
</head>
<body>
    <div id="leafContainer"></div>
    <div id="shootingStarsContainer"></div>
    <div class="initial-prompt" id="initialPrompt">Tap the card to open it, Didiluuu!</div>

    <div class="card-container" id="cardContainer">
        <div class="card" id="mainCard">
            <div class="card-page card-cover visible" id="page0">
                <div class="banner">HAPPY BIRTHDAY DIDILUUU! <span class="heart-icon">üíñ</span></div>
                <img src="cake.png" alt="Cute Birthday Cake" class="cake-image">
                <div class="cover-prompt">(Tap to open)</div>
            </div>
            <div class="card-page" id="page1">
                <div class="message-container">
                    <div class="message">
                        Happy Birthday, My Dearest Didiluuuu <span class="heart-icon">‚ù§Ô∏è</span><br><br>
                        Hey my goddess, my cute panda, my one and only Didi,
                        Happy Birthday! I can't believe how these two years have flown by! It feels like time moved so fast. I guess that's why people say that when we're with our loved ones, years feel like minutes. And Didi, with you, every second feels like a wild, joyful adventure. You're my forever, my safe place, my partner-in-crime who makes even the silliest moments unforgettable.
                    </div>
                </div>
            </div>
            <div class="card-page" id="page2">
                <div class="message-container">
                    <div class="message">
                        Before I met you, I thought the world was full of selfish people‚Äîfolks who just use others like a bandage and toss them aside once they're healed. I was so sure of it. But then you crashed into my life like a glitter bomb of goodness and proved me totally wrong. Didi, you're different. You're special. You're the kind of person who lights up everything around her, even when she doesn't realize it. The world doesn't deserve you, but oh man, it's so lucky to have you.<br><br>
                        <hr class="heart-divider">
                    </div>
                </div>
            </div>
            <div class="card-page" id="page3">
                <div class="message-container">
                    <div class="message">
                        You understand people in a way I've never seen before. The way you listen‚Äîreally listen‚Äîmakes me feel so heard, so safe. I can talk to you about anything and everything, and you just get me. A day without talking to you? It's like something's missing‚Äîlike I've lost a piece of myself. Okati gurthuku petuko, Didi: Nuvvu natho matladina, matladakapoyina, nuvvu naku eppudu important eyy <span class="heart-icon">ü´Ä</span>ü•∫. You're stuck with me, okay? Forever and always.
                        <img src="images/2.jpg" alt="Shared Memory Image" class="page-image">
                    </div>
                </div>
            </div>
            <div class="card-page" id="page4">
                <div class="message-container">
                    <div class="message">
                        But here's the thing, Didi‚ÄîI see you. I see how you put everyone else first, how you carry your pain in silence like it's some secret mission. You pretend everything's fine, but I know you too well. Nuvvu antha pain nee venchukuntey, I feel that pain too. Please, don't hide it all inside. If you're hurting, just say it out loud‚ÄîI'm here to listen. If you're tired, lean on me‚ÄîI've got you.
                        <img src="images/5.jpg" alt="Supportive Image" class="page-image">
                    </div>
                </div>
            </div>
            <div class="card-page" id="page5">
                <div class="message-container">
                    <div class="message">
                        If something doesn't feel right, say "no"‚Äîyou don't have to please everyone. Your happiness matters just as much as anyone else's, okay? Promise me you'll remember that.<br><br>
                        When you feel sad or lost, just whisper my name. I'll be there‚Äîmaybe not always physically, but in every thought, every memory, every moment when you need someone who understands you without words.
                        <hr class="heart-divider">
                    </div>
                </div>
            </div>
            <div class="card-page" id="page6">
                <div class="message-container">
                    <div class="message">
                        No matter how much time we spend together, it's never enough for me. I'm greedy like that‚ÄîI always want more! More walks, more games, more laughter, more of those moments where my inner child comes alive because of you. Every time I see you, I turn into this goofy, happy kid again, and I realize just how lucky I am to have the world's best Didi.<br><br>
                        I still remember the day we met‚Äîback when we were just part of the alumni team, running around like chaos coordinators.
                    </div>
                </div>
            </div>
            <div class="card-page" id="page7">
                <div class="message-container">
                    <div class="message">
                        Who would've thought that one day you'd become my sister, my safe place, my person? From that day, life handed me the most beautiful blessing‚Äîyou. Remember how we'd go to the beach, or walk from college to your house, just talking about everything and nothing? Those little moments turned into my happiest memories. And when the team went out‚Äîmovies, outings, whatever‚Äîif they left you behind, I stayed. Because I couldn't enjoy anything without my Didi.
                    </div>
                </div>
            </div>
            <div class="card-page" id="page8">
                <div class="message-container">
                    <div class="message">
                        Instead, we made our own fun‚ÄîI'd drag you to CMR, we'd play games until we were dizzy, watch movies, laugh until our stomachs hurt. In those moments, I knew I'd found a bond that nothing could break.<br><br>
                        But Didi, it's been a whole month since I last saw you, and I miss you so much it hurts. I know you're studying hard, chasing your dreams like the superhero you are, and I'm so proud of you. But it kills me to see you like this‚Äîstaying up all night, sleeping in the morning, skipping meals.
                        <hr class="heart-divider">
                    </div>
                </div>
            </div>
            <div class="card-page" id="page9">
                <div class="message-container">
                    <div class="message">
                        Please, take care of yourself too. If I could, I'd sit right next to you, force you to eat, remind you that your health matters more than any exam. Because no matter how big your dreams are, <strong>you</strong> are more important to me.<br><br>
                        When you're tired, when you're overwhelmed, just know‚ÄîI'm here. Always. No matter how far apart we are, no matter how crazy life gets, you'll always have me. You're not just my Didi‚Äîyou're my happiness, my home. <span class="heart-icon">üè°</span>
                    </div>
                </div>
            </div>
            <div class="card-page" id="page10">
                <div class="message-container">
                    <div class="message">
                        There's never enough time to spend with you, and I'll always crave more‚Äîmore of your laughter, more of your kindness, more of <strong>you</strong>.<br><br>
                        So on this special day, I want to say thank you. Thank you for coming into my life like a burst of sunshine <span class="heart-icon">‚òÄÔ∏è</span>. Thank you for letting me in, for loving me like a real sister. Thank you for standing by me in every situation, for making me smile even on my worst days. I'm thankful the universe sent you to me, and I'm thankful I found you.
                    </div>
                </div>
            </div>
            <div class="card-page" id="page11">
                <div class="message-container">
                    <div class="message">
                        And Didiluuuu, please, never stop smiling‚Äîbecause your smile is the most beautiful thing in this world. It's the light that keeps me going, the magic that makes everything better. I promise, as long as I'm here, I'll always protect that smile.<br><br>
                        <strong>Happy Birthday, my Didi.</strong> You're my everything, and I hope this day brings you all the joy you deserve‚Äîand more. Let's make more memories soon, okay? I love you beyond words.<br><br>
                        <span class="final-signature">Forever yours,</span><br>
                        <span class="final-name">***** Sidhardh *****</span><br>
                        <span class="final-hearts">
                            <span class="heart-icon">üíñ</span><span class="heart-icon">üíñ</span><span class="heart-icon">üíñ</span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentPage = 0;
        const totalPages = 12;
        let effectsStarted = false;
        let firstClick = true;
        let isTransitioning = false;
        let touchStartX = 0;
        let touchEndX = 0;

        const mainCard = document.getElementById('mainCard');
        const cardContainer = document.getElementById('cardContainer');
        const initialPrompt = document.getElementById('initialPrompt');
        const leafContainer = document.getElementById('leafContainer');
        const shootingStarsContainer = document.getElementById('shootingStarsContainer');

        function throttle(fn, wait) {
            let lastCall = 0;
            return function (...args) {
                const now = new Date().getTime();
                if (now - lastCall >= wait) {
                    lastCall = now;
                    fn(...args);
                }
            };
        }

        function createShootingStars(numStars = 4) {
            if (!shootingStarsContainer) return;
            shootingStarsContainer.innerHTML = '';

            for (let i = 0; i < numStars; i++) {
                const star = document.createElement('div');
                star.className = 'shooting-star';
                const duration = Math.random() * 4 + 4;
                const delay = Math.random() * 10;
                const startX = Math.random() * 70 + 5;
                const startY = Math.random() * -30 - 20;

                star.style.left = `${startX}vw`;
                star.style.top = `${startY}vh`;
                star.style.width = `${Math.random() * 120 + 70}px`;
                star.style.animationDuration = `${duration}s`;
                star.style.animationDelay = `${delay}s`;

                shootingStarsContainer.appendChild(star);
                setTimeout(() => star.remove(), (delay + duration) * 1000 + 100);
            }
            setTimeout(createShootingStars, 15000);
        }

        function createFallingLeaves(count = 20) {
            if (!leafContainer || !effectsStarted || leafContainer.children.length > count * 2) return;

            const leafColors = ['--leaf-color-1', '--leaf-color-2', '--leaf-color-3'];
            const leafShapes = ['', 'shape2', 'shape3'];

            for (let i = 0; i < count; i++) {
                const leaf = document.createElement('div');
                const shape = leafShapes[Math.floor(Math.random() * leafShapes.length)];
                leaf.className = `leaf ${shape}`;
                const colorVar = leafColors[Math.floor(Math.random() * leafColors.length)];
                leaf.style.backgroundColor = `var(${colorVar})`;
                leaf.style.left = Math.random() * 105 - 5 + 'vw';
                leaf.style.animationDuration = Math.random() * 5 + 7 + 's';
                leaf.style.animationDelay = Math.random() * 5 + 's';
                leafContainer.appendChild(leaf);

                const totalDuration = parseFloat(leaf.style.animationDuration) + parseFloat(leaf.style.animationDelay);
                setTimeout(() => leaf.remove(), totalDuration * 1000);
            }

            setTimeout(() => createFallingLeaves(count), 10000);
        }

        function createBalloons(count = 8) {
            if (!effectsStarted || document.querySelectorAll('.balloon').length >= count * 1.5) return;

            for (let i = 0; i < count; i++) {
                const balloon = document.createElement('div');
                balloon.className = 'balloon';
                const hue = Math.random() * 360;
                balloon.style.setProperty('--balloon-hue', hue);
                balloon.style.left = Math.random() * 90 + 5 + 'vw';
                balloon.style.animationDelay = Math.random() * 4 + 's';
                let animDuration = 6;
                if (i % 3 === 0) animDuration = 5;
                else if (i % 2 === 0) animDuration = 7.5;
                balloon.style.animationDuration = animDuration + 's';

                document.body.appendChild(balloon);

                const delay = parseFloat(balloon.style.animationDelay || '0s');
                setTimeout(() => balloon.remove(), (animDuration + delay + 0.5) * 1000);
            }
        }

        function createConfetti(count = 40) {
            if (!effectsStarted) return;

            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                const shape = Math.random() > 0.7 ? 'triangle' : (Math.random() > 0.5 ? 'circle' : '');
                confetti.className = `confetti ${shape}`;
                const color = `hsl(${Math.random() * 360}, 100%, 75%)`;
                if (shape === 'triangle') {
                    confetti.style.setProperty('--confetti-color', color);
                } else {
                    confetti.style.backgroundColor = color;
                }

                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = Math.random() * -50 - 50 + 'px';
                confetti.style.animationDelay = Math.random() * 1.5 + 's';
                confetti.style.animationDuration = Math.random() * 2 + 2.5 + 's';

                document.body.appendChild(confetti);

                const totalDuration = parseFloat(confetti.style.animationDuration) + parseFloat(confetti.style.animationDelay);
                setTimeout(() => confetti.remove(), totalDuration * 1000);
            }
        }

        function createFireworks(count = 3, interval = 1200) {
            if (!effectsStarted || currentPage === 0) return;

            let created = 0;
            const fireworkInterval = setInterval(() => {
                if (!effectsStarted || currentPage === 0 || created >= count) {
                    clearInterval(fireworkInterval);
                    return;
                }
                created++;

                const firework = document.createElement('div');
                firework.className = 'firework';
                firework.style.left = Math.random() * 80 + 10 + 'vw';
                firework.style.top = Math.random() * 50 + 5 + 'vh';
                const color = `hsl(${Math.random() * 360}, 100%, 70%)`;
                firework.style.setProperty('--firework-color', color);
                document.body.appendChild(firework);

                setTimeout(() => firework.remove(), 850);
            }, interval);
        }

        function createHearts(count = 6, interval = 600) {
            if (!effectsStarted || currentPage === 0) return;

            let created = 0;
            const heartInterval = setInterval(() => {
                if (!effectsStarted || currentPage === 0 || created >= count) {
                    clearInterval(heartInterval);
                    return;
                }
                created++;

                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.style.left = Math.random() * 90 + 5 + 'vw';
                heart.style.animationDelay = Math.random() * 1 + 's';
                const animDuration = Math.random() * 3 + 4;
                heart.style.animationDuration = animDuration + 's';
                document.body.appendChild(heart);

                const delay = parseFloat(heart.style.animationDelay || '0s');
                setTimeout(() => heart.remove(), (animDuration + delay + 0.5) * 1000);
            }, interval);
        }

        const throttledCreateBalloons = throttle(createBalloons, 6000);
        const throttledCreateConfetti = throttle(createConfetti, 6000);
        const throttledCreateFireworks = throttle(createFireworks, 6000);
        const throttledCreateHearts = throttle(createHearts, 6000);

        function cleanupAnimations() {
            ['leaf', 'balloon', 'confetti', 'firework', 'heart'].forEach(className => {
                document.querySelectorAll(`.${className}`).forEach(el => el.remove());
            });
        }

        function updatePageVisibility() {
            for (let i = 0; i < totalPages; i++) {
                const page = document.getElementById(`page${i}`);
                if (!page) continue;

                page.classList.remove('visible', 'next-page', 'flipped');
                page.style.transform = 'rotateY(180deg)';
                page.style.opacity = '0';
                page.style.zIndex = '7';

                if (i === currentPage) {
                    page.classList.add('visible');
                    page.style.transform = 'rotateY(0deg)';
                    page.style.opacity = '1';
                    page.style.zIndex = '10';
                } else if (i === currentPage + 1) {
                    page.classList.add('next-page');
                    page.style.transform = 'rotateY(0deg)';
                    page.style.opacity = '1';
                    page.style.zIndex = '9';
                } else if (i < currentPage) {
                    page.classList.add('flipped');
                    page.style.transform = 'rotateY(-180deg)';
                    page.style.opacity = '0';
                    page.style.zIndex = '8';
                }
            }
        }

        function goToPage(pageNumber) {
            if (isTransitioning || pageNumber < 0 || pageNumber >= totalPages || pageNumber === currentPage) {
                return;
            }

            isTransitioning = true;
            const previousPage = currentPage;
            const previousEl = document.getElementById(`page${previousPage}`);

            if (pageNumber > previousPage && previousEl) {
                previousEl.classList.remove('visible');
                previousEl.classList.add('flipped');
                previousEl.style.zIndex = '8';
                previousEl.style.transform = 'rotateY(-180deg)';
                previousEl.style.opacity = '0';
            }

            currentPage = pageNumber;
            updatePageVisibility();

            if (currentPage === 0) {
                effectsStarted = false;
                cleanupAnimations();
            } else if (!effectsStarted) {
                effectsStarted = true;
                createFallingLeaves(20);
                throttledCreateBalloons(8);
                throttledCreateConfetti(40);
                setTimeout(() => throttledCreateFireworks(3, 1200), 500);
                setTimeout(() => throttledCreateHearts(6, 600), 800);
            }

            if (firstClick) {
                if (initialPrompt) initialPrompt.classList.add('hidden');
                firstClick = false;
            }

            setTimeout(() => {
                isTransitioning = false;
            }, 1000);
        }

        function goToNextPage() {
            if (currentPage < totalPages - 1) {
                goToPage(currentPage + 1);
            }
        }

        function goToPreviousPage() {
            if (currentPage > 0) {
                goToPage(currentPage - 1);
            }
        }

        function handleTouchStart(event) {
            if (event.target.closest('.message-container')) {
                touchStartX = 0;
                return;
            }
            touchStartX = event.touches[0].clientX;
        }

        function handleTouchMove(event) {
            if (touchStartX === 0) return;
            touchEndX = event.touches[0].clientX;
        }

        function handleTouchEnd(event) {
            if (event.target.closest('.message-container') || touchStartX === 0) {
                touchStartX = 0;
                touchEndX = 0;
                return;
            }

            const swipeDistance = touchEndX - touchStartX;
            const minSwipeDistance = 100;

            if (swipeDistance > minSwipeDistance && currentPage > 0) {
                goToPreviousPage();
            } else {
                goToNextPage();
            }

            touchStartX = 0;
            touchEndX = 0;
        }

        if ('ontouchstart' in window) {
            cardContainer.addEventListener('touchstart', handleTouchStart, { passive: true });
            cardContainer.addEventListener('touchmove', handleTouchMove, { passive: true });
            cardContainer.addEventListener('touchend', handleTouchEnd);
        }

        cardContainer.addEventListener('click', (event) => {
            if (!event.target.closest('.message-container')) {
                goToNextPage();
            }
        });

        let lastTap = 0;
        cardContainer.addEventListener('touchend', (event) => {
            if (event.target.closest('.message-container')) return;

            const currentTime = new Date().getTime();
            const tapLength = currentTime - lastTap;
            if (tapLength < 300 && tapLength > 0) {
                goToPreviousPage();
            }
            lastTap = currentTime;
        });

        window.onload = function() {
            updatePageVisibility();
            createShootingStars();
        };
    </script>
</body>
</html>
